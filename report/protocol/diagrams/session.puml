@startuml 
hide footbox
skinparam defaultFontSize 16

participant "Client Follower - Julia" as follower
participant "Serveur\nlive.plx.rs:9120" as server
participant "Client Leader - Jack" as leader
skinparam defaultFontSize 15

' Before
follower -> follower: Générer et persister\nclient_id => e9fc3566-32e3-4b98-99b5-35be520d46cb
leader <- leader: Générer et persister client_id =>\nae9b8213-fcf6-40c8-8f35-b6d14f0ace75

' Follower get an empty list of sessions
follower -> server: Ouvrir la connexion (TCP + WebSocket handshake)\nws://live.plx.rs:9120?live_protocol_version=0.1.0\n&live_client_id=e9fc3566-32e3-4b98-99b5-35be520d46cb
follower -> server: Action GetSessions\ngroup_id=https://github.com/samuelroland/plx-demo/
server -> follower: Event SessionsList [  ]

' Session creation
leader -> server: Ouvrir la connexion (...)
leader -> server: Action StartSession "PRG2 Jack" + group_id
server -> leader: Event SessionJoined client_num=0
' attention: pas de Stats ici !

' Follower join
follower -> server: Action GetSessions https://github.com/samuelroland/plx-demo/
server -> follower: Event SessionsList [ "PRG2 Jack" ]
follower -> server: Action JoinSession\nhttps://github.com/samuelroland/plx-demo/ "PRG2 Jack"
server -> follower: Event SessionJoined client_num=1
server -> leader: Event Stats\nfollowers_count=1 leaders_count=1

===== Déroulement de l'entrainement ==
leader -> server: Action StopSession
server -> server: Vérification que le client\nest bien le créateur\nde la session
server -> leader: Event SessionStopped
server -> follower: Event SessionStopped

' Ces IDs doivent rester secrète entre le client et serveur, sinon il serait possible d'impersonner un client.
' Le même client_id ne peut être utilisé sur plusieurs sockets séparés
' Les clients ne peuvent être connecté sur une session à la fois. Les messages n'ont ainsi pas besoin d'indiquer la session concernée, le serveur maintient une map de client_id vers session, et en plus socket vers client_id ?
' Les clients n'ont pas besoin d'informer sur leur nom, juste d'un ID unique qui doit être persisté afin de supporter un redémarrage du client PLX ou une reconnexion.
' Action are actions taken mostly by client, but could also be the server closing the session after inactivity or during shutdown.
' Event are responses to actions, as everything is asynchronous
' exemple messages JSON pour les 2 formats

@enduml
